title: 'Run Sub Workflow Example'

transitions:
  - id: run_workflow
    from: start
    to: sub_workflow_started
    call:
      - tool: executeWorkflowAsync
        id: executeStateful
        args:
          workflow: runSubWorkflowExampleSubWorkflow
          args: {}
          callback:
            transition: sub_workflow_callback

      - tool: createDocument
        args:
          document: linkDocument
          id: subWorkflow_link
          update:
            content:
              icon: 'Clock'
              label: 'Executing Sub-Workflow...'
              href: '/pipelines/{{ runtime.tools.run_workflow.executeStateful.data.task.pipelineId }}'

  - id: sub_workflow_callback
    from: sub_workflow_started
    to: sub_workflow_ended
    trigger: manual
    call:
      - tool: createDocument
        args:
          document: linkDocument
          id: subWorkflow_link
          update:
            content:
              icon: 'CircleCheck'
              label: 'Sub-Workflow {{ runtime.transition.payload.status }}'
              href: '/pipelines/{{ runtime.transition.payload.pipelineId }}'

      - tool: createChatMessage
        args:
          role: 'assistant'
          content: |
            A message from sub workflow 1: {{ runtime.transition.payload.result.message }}

  - id: run_workflow2
    from: sub_workflow_ended
    to: sub_workflow2_started
    call:
      - tool: executeWorkflowAsync
        id: executeStateful
        args:
          workflow: runSubWorkflowExampleSubWorkflow
          args: {}
          callback:
            transition: sub_workflow2_callback
          options:
            runStateless: false

      - tool: createDocument
        args:
          document: linkDocument
          id: subWorkflow2_link
          update:
            content:
              icon: 'Clock'
              label: 'Executing Stateless Sub-Workflow...'

  - id: sub_workflow2_callback
    from: sub_workflow2_started
    to: end
    trigger: manual
    call:
      - tool: createDocument
        args:
          document: linkDocument
          id: subWorkflow2_link
          update:
            content:
              icon: 'CircleCheck'
              label: 'Stateless Sub-Workflow {{ runtime.transition.payload.status }}'

      - tool: createChatMessage
        args:
          role: 'assistant'
          content: |
            A message from sub workflow 2: {{ runtime.transition.payload.result.message }}
